version: 2

models:
  - name: feat_h3_poi_areas_r10
    description: >
      POI areas micro-mart on H3 R10.
      Built in GOLD by aggregating SILVER.POI_AREAS into H3 R10 (centroid-to-cell),
      then LEFT JOINing onto SILVER.DIM_H3_R10_CELLS to keep all cells (empty cells => 0 counts).
      Region join is intentionally NOT used (DIM has no region yet).

      Grain: (region_code, h3_r10).

    tests:
      - rowcount_gt_0:
          config: {name: feat_h3_poi_areas_r10__rowcount_gt_0}

      - dbt_utils.unique_combination_of_columns:
          combination_of_columns: [region_code, h3_r10]
          config: {name: feat_h3_poi_areas_r10__uk_region_h3}

    columns:
      - name: region_code
        tests: [not_null]

      - name: h3_r10
        tests:
          - not_null
          - is_h3_hex:
              config: {name: feat_h3_poi_areas_r10__h3_r10_is_hex}

      - name: cell_area_m2
        tests:
          - not_null
          - num_gt_0:
              config: {name: feat_h3_poi_areas_r10__cell_area_gt_0}

      - name: cell_wkt_4326
        tests:
          - not_null
          - wkt_not_empty:
              config: {name: feat_h3_poi_areas_r10__cell_wkt_not_empty}
          - wkt_prefix_any:
              arguments:
                prefixes: ["POLYGON", "MULTIPOLYGON"]
              config: {name: feat_h3_poi_areas_r10__cell_wkt_prefix_polygonal}

      - name: cell_center_wkt_4326
        tests:
          - not_null
          - wkt_not_empty:
              config: {name: feat_h3_poi_areas_r10__cell_center_wkt_not_empty}
          - wkt_prefix_any:
              arguments:
                prefixes: ["POINT"]
              config: {name: feat_h3_poi_areas_r10__cell_center_wkt_prefix_point}

      - name: poi_areas_cnt
        tests:
          - not_null
          - non_negative:
              config: {name: feat_h3_poi_areas_r10__poi_areas_cnt_non_negative}

      - name: amenity_areas_cnt
        tests:
          - non_negative:
              config: {name: feat_h3_poi_areas_r10__amenity_areas_cnt_non_negative}

      - name: shop_areas_cnt
        tests:
          - non_negative:
              config: {name: feat_h3_poi_areas_r10__shop_areas_cnt_non_negative}

      - name: tourism_areas_cnt
        tests:
          - non_negative:
              config: {name: feat_h3_poi_areas_r10__tourism_areas_cnt_non_negative}

      - name: office_areas_cnt
        tests:
          - non_negative:
              config: {name: feat_h3_poi_areas_r10__office_areas_cnt_non_negative}

      - name: leisure_areas_cnt
        tests:
          - non_negative:
              config: {name: feat_h3_poi_areas_r10__leisure_areas_cnt_non_negative}

      - name: sport_areas_cnt
        tests:
          - non_negative:
              config: {name: feat_h3_poi_areas_r10__sport_areas_cnt_non_negative}

      - name: building_areas_cnt
        tests:
          - non_negative:
              config: {name: feat_h3_poi_areas_r10__building_areas_cnt_non_negative}

      - name: landuse_areas_cnt
        tests:
          - non_negative:
              config: {name: feat_h3_poi_areas_r10__landuse_areas_cnt_non_negative}

      - name: poi_areas_per_km2
        tests:
          - non_negative:
              config: {name: feat_h3_poi_areas_r10__poi_areas_per_km2_non_negative}

      - name: last_load_ts
        description: "Nullable for empty cells (DIM-driven full grid)."