version: 2

models:
  - name: transit_lines
    description: >
      Public transport / infrastructure lines derived from OSM PT_LINES.
      We classify each feature into (railway|waterway|aerialway) based on native columns or tags,
      parse geometry WKT into GEOGRAPHY (WGS84) and keep debug WKT.
      Deduplicated by osm_id (latest load_ts/source_file wins).

    tests:
      - rowcount_gt_0:
          config:
            name: transit_lines__rowcount_gt_0

    columns:
      - name: feature_id
        description: "Stable feature key for ways: 'W<osm_id>'."
        tests: [not_null, unique]

      - name: osm_id
        description: "OSM way id."
        tests: [not_null, unique]

      - name: line_class
        description: "High-level class of the line: railway | waterway | aerialway."
        tests:
          - not_null
          - values_in_or_null:
              column_name: line_class
              values: ["railway", "waterway", "aerialway"]
              config:
                name: transit_lines__line_class_allowed

      - name: line_type
        description: "Specific type from the corresponding tag (railway/waterway/aerialway)."
        tests: [not_null]

      - name: geog
        description: "Line geometry as Snowflake GEOGRAPHY (WGS84)."
        tests: [not_null]

      - name: geom_wkt_4326
        description: "WKT representation of geog (debug/inspection). Expected to be line-like."
        tests:
          - not_null
          - wkt_not_empty:
              column_name: geom_wkt_4326
              config:
                name: transit_lines__geom_wkt_4326_not_empty
          - wkt_prefix_any:
              column_name: geom_wkt_4326
              prefixes: ["LINESTRING", "MULTILINESTRING"]
              config:
                name: transit_lines__geom_wkt_4326_prefix_line

      - name: region_code
        description: "Region/country code from ingestion (e.g., poland, germany)."
        tests: [not_null]

      - name: source_file
        description: "Source file path for lineage/debug."
        tests: [not_null]

      - name: load_ts
        description: "Ingestion/load timestamp used for dedup ordering."
        tests: [not_null]


  - name: transit_points
    description: >
      Public transport / related points derived from OSM PT_POINTS.
      We classify each feature into a small set of POI classes (transport/amenity/emergency),
      parse geometry WKT into GEOGRAPHY (WGS84) and keep debug WKT.
      Deduplicated by osm_id (latest load_ts/source_file wins).

    tests:
      - rowcount_gt_0:
          config:
            name: transit_points__rowcount_gt_0

    columns:
      - name: feature_id
        description: "Stable feature key for nodes: 'N<osm_id>'."
        tests: [not_null, unique]

      - name: osm_id
        description: "OSM node id."
        tests: [not_null, unique]

      - name: name
        description: "Name resolved from `name` or tags:name. Nullable."

      - name: poi_class
        description: "High-level class: transport | amenity | emergency."
        tests:
          - not_null
          - values_in_or_null:
              column_name: poi_class
              values: ["transport", "amenity", "emergency"]
              config:
                name: transit_points__poi_class_allowed

      - name: poi_type
        description: "Specific type within the class (public_transport/railway/highway/amenity/emergency)."
        tests: [not_null]

      - name: geog
        description: "Point geometry as Snowflake GEOGRAPHY (WGS84)."
        tests: [not_null]

      - name: geom_wkt_4326
        description: "WKT representation of geog (debug/inspection). Expected to be POINT."
        tests:
          - not_null
          - wkt_not_empty:
              column_name: geom_wkt_4326
              config:
                name: transit_points__geom_wkt_4326_not_empty
          - wkt_prefix_any:
              column_name: geom_wkt_4326
              prefixes: ["POINT"]
              config:
                name: transit_points__geom_wkt_4326_prefix_point

      - name: region_code
        description: "Region/country code from ingestion (e.g., poland, germany)."
        tests: [not_null]

      - name: source_file
        description: "Source file path for lineage/debug."
        tests: [not_null]

      - name: load_ts
        description: "Ingestion/load timestamp used for dedup ordering."
        tests: [not_null]