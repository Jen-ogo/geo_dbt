version: 2

models:
  - name: building_footprints
    description: >
      Canonical OSM building footprints (nodes/ways) with normalized building_type,
      validated GEOGRAPHY geometry (EPSG:4326), centroid and H3 R10 index.
      Deduplicated by feature_id (latest load_ts/source_file wins).

    columns:
      - name: feature_id
        description: "Stable feature key: 'N<osm_id>' for nodes or 'W<osm_way_id>' for ways."
        tests: [not_null, unique]

      - name: osm_id
        description: "OSM node id if the feature originates from a node. Nullable if it's a way."

      - name: osm_way_id
        description: "OSM way id if the feature originates from a way. Nullable if it's a node."

      - name: building_type
        description: >
          Building type from OSM tag 'building'. Records with building_type='no' are filtered out.
        tests: [not_null]

      - name: building_levels
        description: "Parsed integer from tag 'building:levels' when present. Nullable."
        tests:
          - non_negative:
              name: building_footprints__levels_non_negative

      - name: geog
        description: "Snowflake GEOGRAPHY geometry (WGS84) parsed from raw WKT."
        tests:
          - not_null
          - geog_is_polygonal:
              name: building_footprints__geog_is_poly_or_mpoly

      - name: geom_wkt_4326
        description: "WKT representation of `geog` (debug/inspection)."
        tests:
          - not_null
          - wkt_prefix_any:
              name: building_footprints__wkt_is_poly_or_mpoly
              prefixes: ["POLYGON(", "MULTIPOLYGON("]

      - name: centroid_geog
        description: "Centroid point of the building geometry (GEOGRAPHY)."
        tests:
          - not_null
          - geog_is_point:
              name: building_footprints__centroid_is_point

      - name: h3_r10
        description: "H3 resolution 10 cell id derived from centroid."
        tests:
          - not_null
          - is_h3_hex:
              name: building_footprints__h3_r10_looks_like_h3

      - name: region_code
        description: "Region/country code from ingestion (e.g., 'poland', 'germany')."
        tests: [not_null]

      - name: source_file
        description: "Source file path used for lineage/debug."
        tests: [not_null]

      - name: load_ts
        description: "Ingestion/load timestamp used for deduplication."
        tests: [not_null]


  - name: building_footprints_model
    description: >
      Filtered building footprints for modeling/feature engineering.
      Excludes common non-informative building types (sheds, garages, greenhouses, etc.).

    columns:
      - name: feature_id
        description: "Same stable feature key as in silver.building_footprints."
        tests: [not_null, unique]

      - name: building_type
        description: "Normalized building type. Filtered to remove excluded categories."
        tests: [not_null]

      - name: region_code
        description: "Region/country code."
        tests: [not_null]

      - name: h3_r10
        description: "H3 resolution 10 cell id."
        tests: [not_null]