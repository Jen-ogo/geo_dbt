version: 2

models:
  - name: feat_h3_ev_chargers_r10
    description: >
      H3 r10 feature table: EV charging signal aggregated from silver.ev_chargers to H3 resolution 10,
      then left-joined onto dim_h3_r10_cells to provide complete H3 coverage per region.
      Metrics may be NULL for cells without any matched chargers (left join).

    tests:
      - rowcount_gt_0:
          name: feat_h3_ev_chargers_r10__rowcount_gt_0

    columns:
      - name: region_code
        description: "Region/country code used for partitioning and joins (e.g., 'poland', 'germany')."
        tests:
          - not_null

      - name: h3_r10
        description: "H3 resolution 10 cell id."
        tests:
          - not_null
          - is_h3_hex:
              column_name: h3_r10
              config:
                name: feat_h3_ev_chargers_r10__h3_r10_is_h3_hex

      - name: cell_area_m2
        description: "Reference H3 r10 cell area in square meters from dim_h3_r10_cells."
        tests:
          - not_null
          - non_negative:
              column_name: cell_area_m2
              config:
                name: feat_h3_ev_chargers_r10__cell_area_m2_non_negative

      - name: cell_wkt_4326
        description: "H3 cell polygon WKT in EPSG:4326 (from dim_h3_r10_cells)."
        tests:
          - not_null
          - wkt_not_empty:
              column_name: cell_wkt_4326
              config:
                name: feat_h3_ev_chargers_r10__cell_wkt_not_empty
          - wkt_prefix_in:
              column_name: cell_wkt_4326
              prefixes: ['POLYGON(', 'MULTIPOLYGON(']
              config:
                name: feat_h3_ev_chargers_r10__cell_wkt_polygonal

      - name: cell_center_wkt_4326
        description: "H3 cell center point WKT in EPSG:4326 (from dim_h3_r10_cells)."
        tests:
          - not_null
          - wkt_not_empty:
              column_name: cell_center_wkt_4326
              config:
                name: feat_h3_ev_chargers_r10__cell_center_wkt_not_empty
          - wkt_prefix_in:
              column_name: cell_center_wkt_4326
              prefixes: ['POINT(']
              config:
                name: feat_h3_ev_chargers_r10__cell_center_is_point

      - name: chargers_cnt
        description: >
          Count of OSM charger points that fall into the H3 cell for the given region.
          NULL means no chargers were matched (left join).
        tests:
          - non_negative:
              column_name: chargers_cnt
              config:
                name: feat_h3_ev_chargers_r10__chargers_cnt_non_negative

      - name: sockets_cnt_sum
        description: >
          Sum of total_sockets_cnt for chargers in the cell. NULL means no chargers were matched (left join).
        tests:
          - non_negative:
              column_name: sockets_cnt_sum
              config:
                name: feat_h3_ev_chargers_r10__sockets_cnt_sum_non_negative

      - name: chargers_dc_cnt
        description: >
          Count of chargers in the cell with DC capability (based on silver.ev_chargers flags).
          NULL means no chargers were matched (left join).
        tests:
          - non_negative:
              column_name: chargers_dc_cnt
              config:
                name: feat_h3_ev_chargers_r10__chargers_dc_cnt_non_negative

      - name: chargers_ac_cnt
        description: >
          Count of chargers in the cell with AC capability (based on silver.ev_chargers flags).
          NULL means no chargers were matched (left join).
        tests:
          - non_negative:
              column_name: chargers_ac_cnt
              config:
                name: feat_h3_ev_chargers_r10__chargers_ac_cnt_non_negative

      - name: last_load_ts
        description: >
          Latest load_ts observed among chargers contributing to the cell aggregation.
          NULL means no chargers were matched (left join).